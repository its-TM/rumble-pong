<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: "Press Start 2P", cursive;
      }
      canvas {
        display: block;
        margin: 0 auto;
        border: 2px solid #00ff00;
      }
      .back-button {
        position: absolute;
        top: 20px;
        left: 20px;
        font-family: "Press Start 2P", cursive;
        padding: 10px 14px;
        font-size: 10px;
        color: #00ff00;
        background: black;
        border: 2px solid #00ff00;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
      }
      .back-button:hover {
        background: rgba(0, 255, 0, 0.1);
      }
      body {
        background: black;
        color: white;
        padding: 20px;
      }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  </head>
  <body>
    <a href="main-menu.html" class="back-button">‚Üê Back to Menu</a>
    <script>
      let leftscore = 0;
      let rightscore = 0;
      let puck;
      let left;
      let right;
      let ding;
      let audioEnabled = false;
      let gameStarted = false;
      let showStartScreen = true;

      // Simple beep sound as base64 data URL (avoids CORS issues)
      const beepSound = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEaATCP1+/PdSgELoDO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEaATCP1+/PdSgEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==';

      class Paddle {
          constructor(isLeft) {
              this.y = height/2;
              this.w = 20;
              this.h = 100;
              this.ychange = 0;
              
              if (isLeft) {
                  this.x = this.w;
              } else {
                  this.x = width - this.w;
              }
          }
          
          update() {
              this.y += this.ychange;
              this.y = constrain(this.y, this.h/2, height-this.h/2);
          }
          
          move(steps) {
              this.ychange = steps;
          }
          
          show() {
              fill(255);
              rectMode(CENTER);
              rect(this.x, this.y, this.w, this.h);
          }
      }

      class Puck {
          constructor() {
              this.x = width/2;
              this.y = height/2;
              this.xspeed = 0;
              this.yspeed = 0;
              this.r = 12;
              
              this.reset();
          }
          
          checkPaddleLeft(p) {
              if (this.y - this.r < p.y + p.h/2 &&
                  this.y + this.r > p.y - p.h/2 &&
                  this.x - this.r < p.x + p.w/2) {
                      
                  if (this.x > p.x) {
                      let diff = this.y - (p.y - p.h/2);
                      let rad = radians(45);
                      let angle = map(diff, 0, p.h, -rad, rad);
                      this.xspeed = 5 * cos(angle);
                      this.yspeed = 5 * sin(angle);
                      this.x = p.x + p.w/2 + this.r;
                  }
              }
          }
          
          checkPaddleRight(p) {
              if (this.y - this.r < p.y + p.h/2 &&
                  this.y + this.r > p.y - p.h/2 &&
                  this.x + this.r > p.x - p.w/2) {
                      
                  if (this.x < p.x) {
                      let diff = this.y - (p.y - p.h/2);
                      let angle = map(diff, 0, p.h, radians(225), radians(135));
                      this.xspeed = 5 * cos(angle);
                      this.yspeed = 5 * sin(angle);
                      this.x = p.x - p.w/2 - this.r;
                  }
              }
          }
          
          update() {
              this.x += this.xspeed;
              this.y += this.yspeed;
          }
          
          reset() {
              this.x = width/2;
              this.y = height/2;
              let angle = random(-PI/4, PI/4);
              this.xspeed = 5 * Math.cos(angle);
              this.yspeed = 5 * Math.sin(angle);
              
              if (random(1) < 0.5) {
                  this.xspeed *= -1;
              }
          }
          
          edges() {
              if (this.y < 0 || this.y > height) {
                  this.yspeed *= -1;
              }
              
              if (this.x - this.r > width) {
                  // Play beep sound
                  playBeep();
                  leftscore++;
                  this.reset();
              }
              
              if (this.x + this.r < 0) {
                  // Play beep sound
                  playBeep();
                  rightscore++;
                  this.reset();
              }
          }
          
          show() {
              fill(255);
              ellipse(this.x, this.y, this.r*2);
          }
      }

      function playBeep() {
          if (audioEnabled) {
              try {
                  const audio = new Audio(beepSound);
                  audio.volume = 0.3;
                  audio.play().catch(e => console.log("Audio play failed:", e));
              } catch (e) {
                  console.log("Audio creation failed:", e);
              }
          }
      }

      function setup() {
          createCanvas(600, 400);
          
          puck = new Puck();
          left = new Paddle(true);
          right = new Paddle(false);
          
          // Auto-start after 2 seconds
          setTimeout(() => {
              if (showStartScreen) {
                  showStartScreen = false;
                  gameStarted = true;
                  audioEnabled = true;
              }
          }, 2000);
      }

      function draw() {
          background(0);
          
          // Show start message if game hasn't started
          if (showStartScreen) {
              fill(255);
              textAlign(CENTER);
              textSize(24);
              text("Get Ready!", width/2, height/2 - 50);
              textSize(16);
              text("Controls:", width/2, height/2);
              text("Player 1: W/S    Player 2: I/K", width/2, height/2 + 25);
              return;
          }
          
          puck.checkPaddleRight(right);
          puck.checkPaddleLeft(left);

          left.show();
          right.show();
          left.update();
          right.update();
          
          puck.update();
          puck.edges();
          puck.show();
          
          fill(255);
          textAlign(LEFT);
          textSize(32);
          text(leftscore, 32, 40);
          text(rightscore, width-64, 40);
      }

      function keyReleased() {
          if (gameStarted) {
              left.move(0);
              right.move(0);
          }
      }

      function keyPressed() {
          if (!gameStarted) return;
          
          let upperKey = key.toUpperCase();
          
          if (upperKey == 'W') {
              left.move(-10);
          } else if (upperKey == 'S') {
              left.move(10);
          }

          if (upperKey == 'I') {
              right.move(-10);
          } else if (upperKey == 'K') {
              right.move(10);
          }
      }

      function mousePressed() {
          if (showStartScreen) {
              showStartScreen = false;
              gameStarted = true;
              audioEnabled = true;
          }
      }
    </script>
  </body>
</html>